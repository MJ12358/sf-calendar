!function(){"use strict";const e=document.getElementById("calendar");let t,a=[],n={id:"events",display:"block",color:PARAMETERS.eventColor,events:function(e,t,a){CalendarController.getEvents(PARAMETERS.calendarId,e.start.getTime(),e.end.getTime(),((e,n)=>{n.status?t(e):a(n)}))},failure:function(e){T(e.type,e.message)},eventDataTransform:function(e){return{id:e.Id,start:e.StartDateTime,end:e.EndDateTime,title:e.Subject||e.Type,description:e.Description,allDay:e.IsAllDayEvent}}},i={id:"holidays",display:"block",color:PARAMETERS.holidayColor,events:function(e,t,a){CalendarController.getHolidays(e.start.getTime(),e.end.getTime(),((e,n)=>{n.status?t(e):a(n.message)}))},success:function(e){return Object.keys(e).map((t=>({id:e[t].Id,start:parseInt(t)+o(t),title:l(e[t].Name),allDay:e[t].IsAllDay,isEditable:!1})))},failure:function(e){T(e.type,e.message)}};const s={allDaySlot:PARAMETERS.allDaySlot,businessHours:a,buttonText:{today:"Today",month:"Month",week:"Week",day:"Day",list:"List"},dayMaxEventRows:!0,dayPopoverFormat:{day:"numeric",month:"long",weekday:"long"},defaultTimedEventDuration:"00:30:00",editable:PARAMETERS.editable,eventClick:function(e){if(!s.editable)return;!1!==e.event.extendedProps.isEditable&&u(e)},eventDrop:r,eventResize:r,eventDurationEditable:PARAMETERS.editable,eventSources:[n,i],forceEventDuration:!0,handleWindowResize:!0,headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},height:"100%",initialDate:new Date,initialView:PARAMETERS.initialView,loading:e=>!e&&$("#spinner").fadeOut(),moreLinkClick:"popover",navLinks:!0,nowIndicator:!0,select:function(e){if(!s.selectable)return;if(a.every((e=>!e.startTime&&!e.endTime)))return void u(e);let t=e.start.getDay(),n=e.start.getHours(),i=a.find((e=>e.daysOfWeek[0]===t));n>=m(i.startTime)&&n<m(i.endTime)&&u(e)},selectable:PARAMETERS.selectable,slotMinTime:PARAMETERS.minTimeSlot,slotMaxTime:PARAMETERS.maxTimeSlot,themeSystem:"bootstrap",weekNumbers:PARAMETERS.weekNumbers};function r(e){d(e.event.id,e.event.title,e.event.start.getTime(),e.event.end.getTime()).catch((t=>{e.revert(),T(t.type,t.message)}))}function d(e,a,n,i){return new Promise(((s,r)=>{CalendarController.updateEvent(e,a,n,i,((d,l)=>{if(l.status){let r=t.getEvents().find((t=>t.id===e));r.setDates(n,i),r.setProp("title",a),s(d)}else r(l)}))}))}function l(e){let t=document.createElement("textarea");return t.innerHTML=e,t.value}function o(e){return 6e4*(e?new Date(parseInt(e)):new Date).getTimezoneOffset()}function m(e){return parseInt(e)/1e3/60/60}function u(e){let t=(e=e.event||e).start.getTime(),a=e.end.getTime();$("#title").val(e.title),$("#starts-at")[0].valueAsNumber=t-o(t),$("#ends-at")[0].valueAsNumber=a-o(a),$(".modal").modal("show"),$("#title").focus(),$("#save-button").attr("data-id",e.id)}function T(e,t){$("#alert-title").text(e),$("#alert-message").text(t),$(".alert").css("display","block")}document.addEventListener("DOMContentLoaded",(function(){new Promise(((e,t)=>{CalendarController.getBusinessHours(PARAMETERS.businessHoursId,((a,n)=>{n.status?e(a):t(n)}))})).then((n=>{!function(e){function t(e){return void 0===e?0:0===e?null:e}a.push({daysOfWeek:[0],startTime:t(e.SundayStartTime),endTime:t(e.SundayEndTime)},{daysOfWeek:[1],startTime:t(e.MondayStartTime),endTime:t(e.MondayEndTime)},{daysOfWeek:[2],startTime:t(e.TuesdayStartTime),endTime:t(e.TuesdayEndTime)},{daysOfWeek:[3],startTime:t(e.WednesdayStartTime),endTime:t(e.WednesdayEndTime)},{daysOfWeek:[4],startTime:t(e.ThursdayStartTime),endTime:t(e.ThursdayEndTime)},{daysOfWeek:[5],startTime:t(e.FridayStartTime),endTime:t(e.FridayEndTime)},{daysOfWeek:[6],startTime:t(e.SaturdayStartTime),endTime:t(e.SaturdayEndTime)})}(n),t=new FullCalendar.Calendar(e,s),t.render()})).catch((e=>{T(e.type,e.message)}))})),$("#alert-dismiss").on("click",(function(e){e.preventDefault(),$(".alert").css("display","none")})),$("#save-button").on("click",(function(e){e.preventDefault();let a=$("#save-button").attr("data-id")||null,n=$("#title").val(),i=$("#starts-at")[0].valueAsNumber+o(),s=$("#ends-at")[0].valueAsNumber+o();a?d(a,n,i,s).then((()=>$(".modal").modal("hide"))).catch((e=>T(e.type,e.message))):function(e,a,n){return new Promise(((i,s)=>{CalendarController.createEvent(e,a,n,((e,a)=>{a.status?(t.addEvent({id:e.Id,start:e.StartDateTime,end:e.EndDateTime,title:e.Subject}),t.render(),i(e)):s(a)}))}))}(n,i,s).then((()=>$(".modal").modal("hide"))).catch((e=>T(e.type,e.message)))})),setInterval((()=>{t.refetchEvents()}),3e5)}();